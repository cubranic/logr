<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>Introduction to Logging with logr</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Introduction to Logging with <em>‘logr’</em></h1>
</div>


<p>The <em>logr</em> package implements a logging framework that uses R’s existing messaging functionality, and builds upon it an API that is simple to use. Because it shares the same underpinnings, <em>logr</em> can capture messages and warnings generated by <code>warning</code> and <code>message</code>, making it easy to adopt even in a mature codebase.</p>
<div id="why-a-logging-framework" class="section level2">
<h2>Why a logging framework?</h2>
<p>For any non-trivial piece of code, there are times when it is desirable to display information about its progress. The catch, however, is that different audiences may require a different amount of information at different times.</p>
<p>With base R, this is typically handled with a <code>verbose</code> argument to a function, sometimes in conjunction with using <code>warning</code> vs <code>message</code> to distinguish different types or importance of information. This method has a number of drawbacks, such as that verbosity applies to the directly called function only, or that all messages always go to the screen (unless <code>sink</code> redirects them to a file, in which case <em>nothing</em> appears on the screen).</p>
<p><em>logr</em> addresses both of these, and more, issues:</p>
<ul>
<li>there are multiple predefined levels of message detail</li>
<li>messages can be sent to more than one destination – for instance, a file and the console – and each destination can have a different threshold for the detail level of messages that it will output</li>
<li>the logging threshold can be set for an entire block of running code, rather than just per-function, as with base R</li>
<li>as an added bonus to the readability of your code, the interaction of message detail levels and destination thresholds means that you don’t need to wrap every logging statement in an <code>if (verbose) ...</code>-type check: just send the messages, and let <em>logr</em> decide what to display/record based on your current configuration.</li>
</ul>
</div>
<div id="use" class="section level2">
<h2>Use</h2>
<p>To start using this package, simply call one of the family of <code>*_log</code> functions to output logging messages at the desired level of importance. The functions are helpfully named after their detail level, for instance <code>info_log</code> for level “INFO” (see the “Message levels” section below for the full description of detail levels).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">info_log</span>(<span class="st">'Hello there'</span>)

if (<span class="kw">sample</span>(<span class="dv">6</span>, <span class="dv">1</span>) ==<span class="st"> </span><span class="dv">1</span>)
    <span class="kw">warn_log</span>(<span class="st">'Not your lucky day'</span>)
<span class="kw">trace_log</span>(<span class="kw">paste</span>(<span class="st">'x:'</span>, x))</code></pre>
<p>With no further configuration, these logging messages will be received by the default logging handler, which has only one destination, <code>stderr()</code>, with the “INFO” threshold. What this means is that out-of-the-box, the logging functions work similarly to related functions in <em>base</em>: <code>info_log</code> will act exactly like <code>message</code> (it can even be turned off with <code>suppressMessages</code>), <code>warn_log</code> as <code>warning</code> and <code>error_log</code> as <code>stop</code>. Messages with detail level higher than INFO (i.e., DEBUG and TRACE) will not be printed.</p>
<div id="defining-logging-handlers" class="section level3">
<h3>Defining logging handlers</h3>
<p>To exert finer control, define your own logging handler. This is done by wrapping the code where you want to enable logging inside a call to <code>with_logging</code>. This function has only one required argument, the expression that is run with this logging handler in place. Optional arguments allow you to specify logging destinations and thresholds. Say, for instance, that we want to output at most informational messages to the console while recording fine-level messages in a log file:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with_logging</span>({
    <span class="kw">info_log</span>(<span class="st">'Hello there'</span>)
    
    if (x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">6</span>, <span class="dv">1</span>) ==<span class="st"> </span><span class="dv">1</span>)
        <span class="kw">warn_log</span>(<span class="st">'Not your lucky day'</span>)
    <span class="kw">trace_log</span>(<span class="kw">paste</span>(<span class="st">'x:'</span>, x))
}, <span class="kw">list</span>(<span class="st">'/var/tmp/myapp.log'</span>, <span class="st">'DEBUG'</span>), <span class="kw">stderr</span>())</code></pre>
<p>The destination arguments are <code>list('/var/tmp/myapp.log', 'DEBUG')</code> and <code>stderr()</code>. The first is a two-element list of the file name as a string and an explicit level threshold. The second is just the connection instance, which means that it will inherit the logger’s default threshold. The default threshold is itself specifiable with the <code>level</code> argument, whose default value is “INFO”. So we could have equivalently have written this piece of code as:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with_logging</span>({
    <span class="kw">info_log</span>(<span class="st">'Hello there'</span>)
    
    if (x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">6</span>, <span class="dv">1</span>) ==<span class="st"> </span><span class="dv">1</span>)
        <span class="kw">warn_log</span>(<span class="st">'Not your lucky day'</span>)
    <span class="kw">trace_log</span>(<span class="kw">paste</span>(<span class="st">'x:'</span>, x))
}, <span class="st">'/var/tmp/myapp.log'</span>, <span class="kw">list</span>(<span class="kw">stderr</span>(), <span class="st">'INFO'</span>), <span class="dt">level =</span> <span class="st">'DEBUG'</span>)</code></pre>
</div>
<div id="message-levels" class="section level3">
<h3>Message levels</h3>
<p><em>logr</em> provides the following levels for message detail, from most to least important:</p>
<ul>
<li>ERROR: serious, un-recoverable errors that prevent the code from continuing with further execution</li>
<li>WARN: reporting “suspicious” events, for instance, unexpected NAs, or that some automatic corrective action has failed (e.g., maximum number of retries reached)</li>
<li>INFO: informing on major steps that software is performing, without drowning in too much detail</li>
<li>DEBUG: detailed steps taken by operations</li>
<li>TRACE: use for very detailed debugging, like printing local variable values</li>
</ul>
<p>These levels are similar to those used in <a href="http://logging.apache.org/log4j/"><em>log4j</em></a> and other logging frameworks, and have been proven to be sufficient for most uses.</p>
</div>
</div>
<div id="internals" class="section level2">
<h2>Internals</h2>
<p>Existing messaging functionality in R – that is, <code>stop</code>, <code>warning</code>, and <code>message</code> – uses R’s condition system to emit messages (that is, signal conditions). (See <a href="https://svn.r-project.org/R/trunk/src/library/base/R/stop.R">source</a>.) These messages are received by condition handlers, which invoke “restarts” with well-known default behaviours. Special cases, such as <code>suppressWarnings</code> (<a href="https://svn.r-project.org/R/trunk/src/library/base/R/conditions.R">source</a>), are just condition handlers that invoke non-default restarts, in the case of <code>suppressWarnings</code> the restart that does nothing.</p>
<p>It will then come as no surprise to you that <em>logr</em> uses the same mechanism: message statements signal conditions of custom class <code>LogMessage</code>; logging handlers are R’s condition handlers run inside <code>withConditionHandlers</code> and listening to messages of this class, as well as classes used by <code>stop</code>, <code>warning</code>, and <code>message</code>.</p>
<p>For the most part, this will “just work” and you don’t have to worry about it. But keep the mechanism in mind if you have your own condition handling in place. If you have a custom condition handler (including with <code>try</code> and <code>tryCatch</code>) somewhere in the code that’s run <code>with_logging</code>, and this handler indiscriminately catches all conditions and intercepts those with class <code>LogMessage</code>, you will break <em>logr</em>’s communication mechanism and nothing will be logged!</p>
</div>
<div id="why-be-different-from-log4j" class="section level2">
<h2>Why be different from Log4j?</h2>
<p>Most logging packages today seem to copy Java log4j API. It’s important to remember that Log4j originated as the logging code for the Apache web server. As such, it was designed for use in large, long-running, and complex applications that contain many subsystems and potentially produce many output events every second.</p>
<p><em>Logr</em> instead targets a lighter-weight usage scenario – arguably more likely in an R codebase – of a relatively short, often interactive script or command-line utility. To this purpose, <em>logr</em> provides a minimal API with sensible defaults that requires little effort to use in code, while still allowing multiple logging destinations, each with its own level of detail.</p>
<p>Furthermore, I believe that messages, warnings, and errors produced by the dependent code – whether from core R packages, CRAN, or elsewhere – can be relevant and so need to be loggable. This is why <em>logr</em> builds on R’s existing messaging functionality that uses conditions, handlers, and restarts.</p>
<p>The result, I hope, is a logging framework that is simple, unobtrusive, and pleasant to use. Enjoy!</p>
</div>




</body>
</html>
